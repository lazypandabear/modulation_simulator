<!DOCTYPE html>
<html>
<head>
    <title>Modulator Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Input Section -->
    <form method="POST">
        <div style="border:1px solid #ccc; padding:10px;">
            <h3>Input Section</h3>
            <label>Type of Digital Modulation:</label><br>
            <input type="radio" name="mod_type" value="QAM"  {% if mod_type == 'QAM' %}checked{% endif %}> QAM<br>
            <input type="radio" name="mod_type" value="PSK"  {% if mod_type == 'PSK' %}checked{% endif %}> PSK<br>
            <input type="radio" name="mod_type" value="FSK"  {% if mod_type == 'FSK' %}checked{% endif %}> FSK<br>
            <input type="radio" name="mod_type" value="ASK"  {% if mod_type == 'ASK' %}checked{% endif %}> ASK<br>
            <input type="radio" name="mod_type" value="CSS"  {% if mod_type == 'CSS' %}checked{% endif %}> CSS<br><br>

            <label>Modulation Order (2^x):</label>
            <select name="mod_order">
                {% for val in [2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536] %}
                    <option value="{{val}}" {% if mod_order == val %}selected{% endif %}>{{val}}</option>
                {% endfor %}
            </select><br><br>

            <label>SNR (dB):</label><br>
            <input type="number" step="0.01" name="snr" value="{{snr}}"><br><br>

            <label>Target Data Rate (Mbps):</label><br>
            <input type="number" step="0.01" name="target_data_rate" value="{{target_data_rate}}"><br><br>

            <label>Sample Data Stream (bits):</label><br>
            <input type="text" name="sample_data" value="{{sample_data}}"><br><br>

            <label>Auto Compute:</label>
            <input type="checkbox" name="auto_compute" {% if auto_compute %}checked{% endif %} 
                   onchange="this.form.submit()">
            <br><br>

            <button type="submit">Run Simulation</button>
        </div>
    </form>

    <!-- Result Section -->
    <div style="border:1px solid #ccc; padding:10px; margin-top:10px;">
        <h3>Result Section</h3>
        <div style="display:flex; justify-content:space-around;">
            <!-- Calculated Value -->
            <div>
                <h4>Calculated Value</h4>
                {% if calc_values.error %}
                    <p style="color:red;">{{calc_values.error}}</p>
                {% else %}
                    <ul>
                    {% for key, val in calc_values.items() %}
                        {% if key != 'error' %}
                            <li><strong>{{key}}:</strong> {{val}}</li>
                        {% endif %}
                    {% endfor %}
                    </ul>
                {% endif %}
            </div>

            <!-- Standard Value -->
            <div>
                <h4>Standard Value</h4>
                <ul>
                {% for key, val in standard_values.items() %}
                    <li><strong>{{key}}:</strong> {{val}}</li>
                {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <!-- Chart Section -->
    <div style="border:1px solid #ccc; padding:10px; margin-top:10px;">
        <h3>Chart Section</h3>
        <canvas id="timeDomainChart"></canvas>
    </div>

    <script>
        var ctx = document.getElementById('timeDomainChart').getContext('2d');
        var chartData = {{ time_domain_data|safe }};
        var labels = [];
        for(var i=0; i<chartData.length; i++){
            labels.push(i);
        }
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Time Domain Signal',
                    data: chartData,
                    borderColor: 'blue',
                    fill: false
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Sample Index'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Amplitude'
                        }
                    }
                }
            }
        });

        // Auto compute on change if needed
        // If you want the form to submit automatically when inputs change (except for checkbox):
        document.querySelectorAll('input[type="number"], input[type="text"], select').forEach(el => {
            el.addEventListener('change', () => {
                var autoCompute = document.querySelector('input[name="auto_compute"]');
                if(autoCompute && autoCompute.checked) {
                    document.forms[0].submit();
                }
            });
        });
    </script>
</body>
</html>
